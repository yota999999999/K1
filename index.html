<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Spin Final Fix</title>

<style>
body{
    margin:0;
    font-family:Arial,sans-serif;
    background:transparent;
    text-align:center;
}
.container{
    width:260px;
    margin:15px auto;
    padding:10px;
    border-radius:12px;
}
.header{color:white;font-size:12px}
.viewport{
    width:240px;height:60px;
    overflow:hidden;
    border:2px solid white;
    border-radius:8px;
    margin:10px auto;
    position:relative;
}
.arrow{
    position:absolute;
    top:-8px;left:50%;
    transform:translateX(-50%);
    color:yellow;font-size:12px;
    z-index:10;
}
.track{display:flex;height:60px}
.item{
    width:60px;height:60px;
    flex-shrink:0;
    display:flex;
    align-items:center;
    justify-content:center;
}
.item img{width:48px;height:48px}

.zonk{background:#444}
.sc{background:limegreen}
.mitos{background:red}
.kraken{background:#0b3c5d}

.stop{
    box-shadow:inset 0 0 0 3px white,0 0 12px gold;
}
.spin-btn{
    width:55px;height:55px;
    border-radius:50%;
    border:2px solid white;
    background:rgba(255,255,255,.15);
}
.result{margin-top:6px;min-height:60px}
.result img{width:32px;height:32px}
</style>
</head>

<body>

<div class="container">
    <div class="header">ðŸ’° 5 Coin untuk 1 Putaran</div>

    <div class="viewport">
        <div class="arrow">â–¼</div>
        <div class="track" id="track"></div>
    </div>

    <button class="spin-btn" onclick="spin()"></button>
    <div class="result" id="result"></div>
</div>

<!-- AUDIO -->
<audio id="spinSound" src="spin1.mp3"></audio>
<audio id="zonkAudio" src="zonk1.mp3"></audio>
<audio id="sctbAudio" src="sctb1.mp3"></audio>
<audio id="mitosAudio" src="mitos1.mp3"></audio>
<audio id="krakenAudio" src="kraken.mp3"></audio>

<script>
/* VISUAL */
const visual = [
    { id:"K",  cls:"kraken", img:"kraken.png", audio:"krakenAudio" },
    { id:"A",  cls:"zonk",   img:"zonk.png",   audio:"zonkAudio" },
    { id:"SC", cls:"sc",     img:"sc_tb.png",  audio:"sctbAudio" },
    { id:"MT", cls:"mitos",  img:"mitos.png",  audio:"mitosAudio" }
];

/* PERSENTASE SLOT
   Zonk 74%
   Mitos 20%
   SC TB 5%
   Kraken 1%
*/
const winPool = [
    { id:"K",  w:10  },  // 1%
    { id:"SC", w:50  },  // 5%
    { id:"MT", w:200 },  // 20%
    { id:"A",  w:740 }   // 74%
];

const track = document.getElementById("track");
const spinSound = document.getElementById("spinSound");
let data=[];

/* PERPANJANG TRACK (ANTI KOSONG) */
for(let i=0;i<200;i++){
    const h = visual[i % visual.length];
    data.push(h);
    if(h.id!=="A"){
        data.push({id:"A",cls:"zonk",img:"zonk.png",audio:"zonkAudio"});
        data.push({id:"A",cls:"zonk",img:"zonk.png",audio:"zonkAudio"});
    }
}

data.forEach(h=>{
    const d=document.createElement("div");
    d.className=`item ${h.cls}`;
    d.dataset.id=h.id;
    d.dataset.audio=h.audio;
    d.innerHTML=`<img src="${h.img}">`;
    track.appendChild(d);
});

function playPrizeAudio(id){
    if(!id)return;
    const a=document.getElementById(id);
    if(!a)return;
    a.currentTime=0;
    a.play().catch(()=>{});
}

function pick(){
    let pool=[];
    winPool.forEach(h=>{
        for(let i=0;i<h.w;i++) pool.push(h.id);
    });
    return pool[Math.floor(Math.random()*pool.length)];
}

/* ===== SPIN FINAL (KANAN TERUS + PANJANG) ===== */
function spin(){
    spinSound.currentTime=0;
    spinSound.loop=true;
    spinSound.play().catch(()=>{});

    const items=document.querySelectorAll(".item");
    items.forEach(i=>i.classList.remove("stop"));
    document.getElementById("result").innerHTML="";

    /* RESET POSISI (ANTI MUNDUR) */
    track.style.transition="none";
    track.style.transform="translateX(0)";
    track.offsetHeight;

    const winner = pick();
    const targets = data
      .map((h,i)=>h.id===winner?i:null)
      .filter(i=>i!==null);

    const base = 50; // MINIMAL JARAK PUTARAN
    const index =
      targets[Math.floor(Math.random()*targets.length)] + base;

    const ITEM=60;
    const center=120-(ITEM/2);

    track.style.transition="transform 7s cubic-bezier(.08,.85,.15,1)";
    track.style.transform=
      `translateX(${-(index*ITEM)+center}px)`;

    setTimeout(()=>{
        spinSound.pause();
        spinSound.currentTime=0;

        const arrowX =
          document.querySelector(".arrow").getBoundingClientRect().left + 6;

        let closest=0,dist=Infinity;
        items.forEach((it,i)=>{
            const c=it.getBoundingClientRect().left+30;
            const d=Math.abs(c-arrowX);
            if(d<dist){dist=d;closest=i;}
        });

        items[closest].classList.add("stop");
        document.getElementById("result")
          .appendChild(items[closest].querySelector("img").cloneNode());

        playPrizeAudio(items[closest].dataset.audio);
    },7000);
}
</script>

</body>
</html>
